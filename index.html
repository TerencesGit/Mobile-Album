<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Mobile Album</title>
    <link rel="stylesheet" href="css/animate.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <ul class="container">
    </ul>
    <div class="large">
    	<img class="large-img animated fadeInDown">
    </div>
    <script src="js/zepto.min.js"></script>
    <script src="js/touch.js"></script>
    <script>
    $(function() {
        var total = 17;
        var winWidth = $(window).width(),
        	  winHeight = $(window).height();
        var render = function() {
            var padding = 2;
            var picWidth = Math.floor((winWidth - padding * 3) / 4);
            var tmpl = '';
            for (var i = 1; i <= total; i++) {
                var padd = padding;
                var imgSrc = 'images/' + i + '.jpg';
                if (i % 4 == 1) {
                    padd = 0
                }
                tmpl += '<li data-id="'+i+'" class="animated bounceIn" style="width: ' + picWidth + 'px; height:' + picWidth + 'px;padding-top:' + padding + 'px;padding-left:' + padd + 'px"><canvas id="cvs_'+i+'"></canvas></li>';
                var imageObj = new Image();
                imageObj.index = i;
                imageObj.onload = function(){
                	var cvs = $('#cvs_'+this.index)[0].getContext('2d');
                	cvs.width = this.width;
                	cvs.height = this.height;
                	cvs.drawImage(this,0,0)
                }
                imageObj.src = imgSrc;
            }
            $('.container').html(tmpl)
        }
        render()
        var largeImg = $('.large-img');
        var loadImg = function(id){
        	$('.large').show()
        	var imgSrc = 'images/'+id+'.large.jpg';
        	var imgObj = new Image();
        	imgObj.onload = function(){
        		var w = this.width;
        		var h = this.height;
        		var realW = winHeight*w/h;
        		var realH = winWidth*h/w;
        		var paddingLeft = parseInt((winWidth-realW)/2);
        		var paddingTop = parseInt((winHeight-realH)/2)
        		if(h/w>1.2){
        			largeImg.attr('src',imgSrc).css({
        				'height': winHeight,
        				'paddingLeft': paddingLeft
        			})
        		}else{
        			largeImg.attr('src',imgSrc).css({
        				'width': winWidth,
        				'paddingTop': paddingTop
        			})
        		}
        	}
        	imgObj.src = imgSrc
        }
        $('.container').delegate('li','tap',function(){
        	var _id = $(this).attr('data-id'); 
        	console.log(_id)
        	loadImg(_id)
        })

    })
    </script>
</body>

</html>
